<app-stepper-page>
  <app-page-header>
    <ng-container subHeader>
      All fields are required.
    </ng-container>
  </app-page-header>

  <div *ngIf="ticket; else noTicket">
    <form (ngSubmit)="onSubmit()"
          [formGroup]="form"
          novalidate>
      <section class="mb-2">
        <div class="row">
          <div class="col-md-6">
            <mat-form-field class="w-100">
              <mat-label>Surname</mat-label>
              <input matInput
                     formControlName="lastName" />
              <mat-error>{{ "error.required" | translate }}</mat-error>
            </mat-form-field>
          </div>
          <div class="col-md-6">
            <mat-form-field class="w-100">
              <mat-label>Given names</mat-label>
              <input matInput
                     formControlName="givenNames" />
              <mat-error>{{ "error.required" | translate }}</mat-error>
            </mat-form-field>
          </div>
        </div>

        <!--section>
          <app-address-form-autocomplete
            (autocompleteAddress)="onAutocomplete($event)">
            <button *ngIf="showManualButton"
              mat-button
              type="button"
              color="primary"
              [disabled]="showAddressFields"
              (click)="showManualAddress()">
              <mat-icon>add</mat-icon>
              Add address manually
            </button>
          </app-address-form-autocomplete>
        </section -->

        <!-- section [ngClass]="{'hide-address': !showAddressFields}" -->
          <div class="row">
            <div class="col-md-6">
              <mat-form-field class="w-100">
                <mat-label>Mailing address</mat-label>
                <input matInput
                       formControlName="mailingAddress" />
                <mat-error>{{ "error.required" | translate }}</mat-error>
              </mat-form-field>
            </div>
            <div class="col-md-6">
              <mat-form-field class="w-100">
                <mat-label>Country</mat-label>
                <input matInput
                       formControlName="country" />
                <mat-error>{{ "error.required" | translate }}</mat-error>
              </mat-form-field>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <mat-form-field class="w-100">
                <mat-label>City</mat-label>
                <input matInput
                       formControlName="city" />
                <mat-error>{{ "error.required" | translate }}</mat-error>
              </mat-form-field>
            </div>
            <div class="col-md-6">
              <mat-form-field class="w-100">
                <mat-label>Province</mat-label>
                <mat-select formControlName= "province" >
                  <mat-option *ngFor="let province of provinces" [value]="province.name">
                    {{ province.name }}
                  </mat-option>
                </mat-select>
                <mat-error>{{ "error.required" | translate }}</mat-error>
              </mat-form-field>
            </div>
          </div>
        <!-- /section -->

        <div class="row">

          <div class="col-md-6">
            <mat-form-field class="w-100">
              <mat-label>Postal code</mat-label>
              <input matInput
                     mask="S0S 0S0"
                     oninput="this.value = this.value.toUpperCase()"
                     formControlName="postalCode"
                     [showMaskTyped]="true" />
              <mat-error *ngIf="form.get('postalCode').hasError('required')">{{ "error.required" | translate }}</mat-error>
              <mat-error *ngIf="form.get('postalCode').hasError('pattern')">Must be a valid postal code</mat-error>
            </mat-form-field>
          </div>
          <div class="col-md-6">
            <mat-form-field class="w-100">
              <mat-label>Birthdate</mat-label>
              <input matInput
                     [max]="maxDateOfBirth"
                     [matDatepicker]="picker"
                     formControlName="birthdate"
                     readonly
                     (click)="picker.open()" />
              <mat-datepicker-toggle matSuffix
                                     [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker
                              [touchUi]="isMobile"
                              startView="multi-year"></mat-datepicker>
              <mat-error *ngIf="form.get('birthdate').hasError('required')">{{
                "error.required" | translate
                }}</mat-error>
            </mat-form-field>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <mat-form-field class="w-100">
              <mat-label>Phone number</mat-label>
              <input matInput
                     formControlName="phoneNumber"
                     mask="(000) 000-0000"
                     [showMaskTyped]="true" />
              <mat-error *ngIf="phoneNumber.hasError('required')">{{
                "error.required" | translate
                }}</mat-error>
              <mat-error *ngIf="phoneNumber.hasError('phone')">Must be a valid phone number</mat-error>
            </mat-form-field>
          </div>
          <div class="col-md-6">
            <mat-form-field class="w-100">
              <mat-label>Email address</mat-label>
              <input matInput
                     formControlName="emailAddress"
                     autocomplete="off" />
              <mat-error *ngIf="emailAddress.hasError('required')">{{
                "error.required" | translate
                }}</mat-error>
              <mat-error *ngIf="emailAddress.hasError('email')">{{
                "error.email_address" | translate
                }}</mat-error>
            </mat-form-field>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <mat-form-field class="w-100">
              <mat-label>Driver's licence number</mat-label>
              <input matInput
                     formControlName="driverLicenseNumber"
                     mask="0000000"
                     [showMaskTyped]="false" />
              <mat-error *ngIf="form.get('driverLicenseNumber').hasError('required')">{{ "error.required" | translate }}</mat-error>
              <mat-error 
                *ngIf="form.get('driverLicenseNumber').hasError('pattern') ||
                  form.get('driverLicenseNumber').hasError('minlength') ||
                  form.get('driverLicenseNumber').hasError('maxlength')">
                Must be a valid driver's license number of 7 digits
            </mat-error>
            </mat-form-field>
          </div>

          <div class="col-md-6">
            <mat-form-field class="w-100">
              <mat-label>Province of state of driver's licence</mat-label>
                     <mat-select formControlName= "driverLicenseProvince" >
                      <mat-option *ngFor="let province of provinces" [value]="province.name">
                        {{ province.name }}
                      </mat-option>
                    </mat-select>
              <mat-error>{{ "error.required" | translate }}</mat-error>
            </mat-form-field>
          </div>
        </div>
      </section>
    </form>
  </div>

  <ng-template #noTicket>
    <h2>No current ticket</h2>
  </ng-template>

  <!-- [secondaryActionButtonLabel]="prevBtnLabel"-->
  <app-stepper-footer (save)="onSubmit()"
                      (back)="onBack()"
                      [disableSave]="!(form.valid)"
                      [secondaryActionButtonIcon]="previousButtonIcon"
                      [secondaryActionButtonKey]="previousButtonKey"
                      [saveButtonKey]="saveButtonKey"
                      [hasSecondaryAction]="true"></app-stepper-footer>
</app-stepper-page>
